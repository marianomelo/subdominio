---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const allBlogPosts = await getCollection('blog');

const sortedPosts = allBlogPosts.sort((a, b) =>
  new Date(b.data.publishedDate).getTime() - new Date(a.data.publishedDate).getTime()
);

const uniqueCategories = [...new Set(allBlogPosts.map(post => post.data.category))].filter(Boolean);

const formatDate = (dateString) => {
  const date = new Date(dateString);
  return date.toLocaleDateString('es-ES', {
    day: 'numeric',
    month: 'short',
    year: 'numeric'
  });
};
---

<Layout title="Blog" description="Artículos sobre desarrollo web, e-commerce, automatización y tendencias tecnológicas. Conocimiento compartido por el equipo de Subdominio.">
	<!-- Hero -->
	<section class="pt-32 lg:pt-40 pb-16 lg:pb-24 bg-white dark:bg-gray-900">
		<div class="container mx-auto px-6 lg:px-12">
			<div class="max-w-4xl">
				<div class="flex items-center gap-4 mb-8">
					<span class="text-sm tracking-[0.2em] uppercase text-gray-400 dark:text-gray-500">
						Blog
					</span>
					<div class="h-px w-12 bg-gray-300 dark:bg-gray-700"></div>
				</div>

				<h1 class="font-display text-4xl sm:text-5xl lg:text-6xl font-medium text-black dark:text-white leading-[1.1] mb-8">
					Ideas y <span class="italic">reflexiones</span>
				</h1>

				<p class="text-lg lg:text-xl text-gray-600 dark:text-gray-300 leading-relaxed max-w-2xl">
					Artículos sobre desarrollo web, e-commerce, automatización y las últimas
					tendencias tecnológicas.
				</p>
			</div>
		</div>
	</section>

	<!-- Categories filter -->
	{uniqueCategories.length > 0 && (
		<section class="py-6 bg-white dark:bg-gray-900 border-b border-gray-100 dark:border-gray-800">
			<div class="container mx-auto px-6 lg:px-12">
				<div class="flex flex-wrap gap-4">
					<button data-filter="all" class="filter-btn text-sm tracking-wide text-black dark:text-white border-b-2 border-black dark:border-white pb-1 active">
						Todos
					</button>
					{uniqueCategories.map(category => (
						<button data-filter={category} class="filter-btn text-sm tracking-wide text-gray-500 dark:text-gray-400 hover:text-black dark:hover:text-white transition-colors duration-300 pb-1 border-b-2 border-transparent">
							{category}
						</button>
					))}
				</div>
			</div>
		</section>
	)}

	<!-- Articles -->
	<section class="py-16 lg:py-24 bg-gray-50 dark:bg-gray-950">
		<div class="container mx-auto px-6 lg:px-12">
			<div id="articles-grid" class="space-y-0 border-t border-gray-200 dark:border-gray-800">
				{sortedPosts.map((post, index) => (
					<article data-category={post.data.category} class="article-item border-b border-gray-200 dark:border-gray-800 py-10 lg:py-12 group">
						<div class="grid lg:grid-cols-12 gap-6 lg:gap-8">
							<div class="lg:col-span-2">
								<span class="text-sm text-gray-400 dark:text-gray-500">
									{formatDate(post.data.publishedDate)}
								</span>
							</div>
							<div class="lg:col-span-6">
								<a href={`/blog/${post.data.slug || post.slug}`} class="block group-hover:opacity-70 transition-opacity duration-300">
									<h2 class="font-display text-xl lg:text-2xl font-medium text-black dark:text-white mb-3 leading-tight">
										{post.data.title}
									</h2>
									<p class="text-gray-600 dark:text-gray-400 text-sm leading-relaxed">
										{post.data.excerpt}
									</p>
								</a>
							</div>
							<div class="lg:col-span-3 lg:col-start-10 flex items-start lg:justify-end">
								<span class="text-xs tracking-[0.15em] uppercase text-gray-400 dark:text-gray-500">
									{post.data.category}
								</span>
							</div>
						</div>
					</article>
				))}
			</div>
		</div>
	</section>

	<!-- Newsletter -->
	<section class="py-24 lg:py-32 bg-black dark:bg-gray-200">
		<div class="container mx-auto px-6 lg:px-12">
			<div class="max-w-2xl">
				<h2 class="font-display text-3xl sm:text-4xl lg:text-5xl font-medium text-white dark:text-black leading-tight mb-6">
					¿Te gustó este <span class="italic">contenido?</span>
				</h2>
				<p class="text-lg text-gray-400 dark:text-gray-600 mb-10">
					Suscríbete para recibir los últimos artículos sobre desarrollo web,
					e-commerce y automatización directamente en tu inbox.
				</p>

				<form class="flex flex-col sm:flex-row gap-4">
					<input
						type="email"
						placeholder="tu@email.com"
						class="flex-1 px-6 py-4 bg-white/10 dark:bg-black/10 border border-gray-700 dark:border-gray-300 text-white dark:text-black placeholder-gray-500 focus:outline-none focus:border-white dark:focus:border-black transition-colors duration-300"
						required
					/>
					<button
						type="submit"
						class="px-8 py-4 bg-white dark:bg-black text-black dark:text-white font-medium hover:bg-gray-200 dark:hover:bg-gray-800 transition-colors duration-300"
					>
						Suscribirse
					</button>
				</form>

				<p class="text-xs text-gray-500 mt-4">
					No spam. Solo contenido de calidad. Puedes darte de baja cuando quieras.
				</p>
			</div>
		</div>
	</section>

	<script>
		document.addEventListener('DOMContentLoaded', function() {
			const filterButtons = document.querySelectorAll('.filter-btn');
			const articleItems = document.querySelectorAll('.article-item');

			filterButtons.forEach(button => {
				button.addEventListener('click', function() {
					const filterValue = this.getAttribute('data-filter');

					filterButtons.forEach(btn => {
						btn.classList.remove('active', 'text-black', 'dark:text-white', 'border-black', 'dark:border-white');
						btn.classList.add('text-gray-500', 'dark:text-gray-400', 'border-transparent');
					});

					this.classList.add('active', 'text-black', 'dark:text-white', 'border-black', 'dark:border-white');
					this.classList.remove('text-gray-500', 'dark:text-gray-400', 'border-transparent');

					articleItems.forEach(article => {
						const articleCategory = article.getAttribute('data-category');

						if (filterValue === 'all' || articleCategory === filterValue) {
							article.style.display = 'block';
						} else {
							article.style.display = 'none';
						}
					});
				});
			});
		});
	</script>
</Layout>
